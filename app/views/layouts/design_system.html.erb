<% environment = GovukPublishingComponents::AppHelpers::Environment.current_acceptance_environment %>

<%= render "govuk_publishing_components/components/layout_for_admin", {
  product_title: "Publisher",
  browser_title: yield(:page_title),
  environment: environment
} do %>

  <% render "layouts/google_tag_manager" %>

  <%= render "govuk_publishing_components/components/skip_link" %>

  <%= render "govuk_publishing_components/components/layout_header", {
    product_name: "Publisher",
    environment: environment,
    navigation_items: navigation_items(is_editor: current_user.govuk_editor?, path: request.path, user_name: current_user.name)
  } %>

  <div class="govuk-width-container">

    <main class="govuk-main-wrapper govuk-main-wrapper--auto-spacing" id="main-content" role="main">
      <% [:success, :info, :warning, :danger, :notice, :alert].select { |k| flash[k].present? }.each do |k| %>
        <%
          case k
          when :notice
            alert_class = "success"
          when :alert
            alert_class = "danger"
          else
            alert_class = k
          end
        %>
        <div class="alert alert-<%= alert_class %>"
          data-module="auto-track-event"
          data-track-action="alert-<%= alert_class %>"
          data-track-label="<%= strip_tags(flash[k]) %>">
            <%= flash[k] %>
        </div>
      <% end %>      
      <% if yield(:title).present? %>
        <div class="govuk-grid-row">
          <div class="govuk-grid-column-two-thirds">
            <%= render "govuk_publishing_components/components/title", {
              title: yield(:title),
              context: yield(:title_context),
              margin_top: 0,
              margin_bottom: 6,
            } %>
          </div>
        </div>
      <% end %>

      <div class="govuk-grid-row">
        <%= yield %>
      </div>
    </main>
  </div>

  <%= render "govuk_publishing_components/components/layout_footer", {
    navigation: [
      {
        title: "Support and feedback",
        items: [
          {
            href: Plek.external_url_for("support"),
            text: "Raise a support request",
          },
          {
            href: "https://status.publishing.service.gov.uk/",
            text: "Check if publishing apps are working or if thereâ€™s any maintenance planned",
          },
        ],
      },
    ],
  } %>
<% end %>
